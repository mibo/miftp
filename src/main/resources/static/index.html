<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Basic InMemory FTP server</title>
  <script>
      var request = null;
      var REQUEST_TIMEOUT_SEC = 600;

      function receiveMessages() {
          if (request !== null) {
              console.log("Abort running XMLHttpRequest...");
              request.abort();
              request = null;
          }
          var xmlhttp = new XMLHttpRequest();
          request = xmlhttp;
          xmlhttp.open("GET", "./files");
          xmlhttp.seenBytes = 0;
          xmlhttp.onreadystatechange = function () {
              if (this.readyState > 2) {
                  var message = xmlhttp.responseText.substr(xmlhttp.seenBytes);
                  console.log("Received message: " + message);
                  // process message
                  xmlhttp.seenBytes = xmlhttp.responseText.length;
                  var fileList = JSON.parse(message);
                  console.log("Received file list: " + fileList);
                  var list = document.getElementById("list");
                  fileList.forEach(function (file) {
                      var li = document.createElement("li");
                      var pre = document.createElement("pre");
                      // pre.innerHTML = JSON.stringify(fileList, null, 2);
                      console.log("handling file: " + file);
                      pre.innerHTML = "Name: " + file.name + " modified at " + new Date(file.lastModified).toLocaleString() +
                                      " (<a href='./files/" + file.name + "/content'>content</a>)";
                      li.appendChild(pre);
                      list.insertBefore(li, list.childNodes[0]);
                  });
              } else {
                  console.log("Wrong state after GET: " + this.readyState)
              }
          };
          // use global timeout in seconds (multiply for millisecond)
          xmlhttp.timeout = REQUEST_TIMEOUT_SEC * 1000;
          xmlhttp.ontimeout = function () {
              // XMLHttpRequest timed out. Do something here.
              document.getElementById("state").innerHTML = "Failed to receive response (timed out)...";
          };
          //
          // send request
          xmlhttp.send();
      }
  </script>
</head>

<body onload="receiveMessages()">
<div>
  <h2>FTP server content</h2>
  <h3>Files:</h3>
  <ul id="list"></ul>
</div>
</body>

</html>